// Generated by HLC 4.3.4 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <sys/thread/_Thread/HaxeThread.h>
#include <hl/natives.h>
extern sys__thread___Thread__$HaxeThread g$_sys_thread__Thread_HaxeThread;
extern hl_type t$sys_thread__Thread_HaxeThread;
void sys_thread__Thread_HaxeThread_new(sys__thread___Thread__HaxeThread,hl_thread*);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
#include <haxe/Exception.h>
extern hl_type t$fun_0ecc9bc;
void sys_thread_EventLoop_loop(sys__thread__EventLoop);
haxe__Exception haxe_Exception_caught(vdynamic*);
void sys_thread__Thread_HaxeThread_dropThread(sys__thread___Thread__HaxeThread);
extern hl_type t$sys_thread_EventLoop;
void sys_thread_EventLoop_new(sys__thread__EventLoop);
extern hl_type t$ctx_2c507b6;
extern hl_type t$fun_0d44617;
#include <hl/types/ArrayBase.h>
hl__types__ArrayBase hl_types_ArrayObj_splice(hl__types__ArrayObj,int,int);
extern hl_type t$hl_types_ArrayObj;
extern hl_type t$hl_types_ArrayBase;

sys__thread___Thread__HaxeThread sys_thread__Thread_HaxeThread_current() {
	sys__thread___Thread__HaxeThread r4, r11;
	hl__types__ArrayObj r9;
	hl_thread *r0, *r2, *r3;
	hl_mutex *r7;
	sys__thread___Thread__$HaxeThread r5;
	vdynamic *r6;
	varray *r12;
	int r8, r10;
	r0 = hl_thread_current();
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r4 = r5->mainThread;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->handle;
	if( r0 != r3 ) goto label$ca28e11_1_9;
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r4 = r5->mainThread;
	return r4;
	label$ca28e11_1_9:
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r7 = r5->threadsMutex;
	hl_mutex_acquire(r7);
	r4 = NULL;
	r8 = 0;
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r9 = r5->threads;
	label$ca28e11_1_16:
	if( r9 == NULL ) hl_null_access();
	r10 = r9->length;
	if( r8 >= r10 ) goto label$ca28e11_1_34;
	r10 = r9->length;
	if( ((unsigned)r8) < ((unsigned)r10) ) goto label$ca28e11_1_24;
	r11 = NULL;
	goto label$ca28e11_1_27;
	label$ca28e11_1_24:
	r12 = r9->array;
	r6 = ((vdynamic**)(r12 + 1))[r8];
	r11 = (sys__thread___Thread__HaxeThread)r6;
	label$ca28e11_1_27:
	++r8;
	if( r11 == NULL ) hl_null_access();
	r2 = r11->handle;
	if( r2 != r0 ) goto label$ca28e11_1_33;
	r4 = r11;
	goto label$ca28e11_1_34;
	label$ca28e11_1_33:
	goto label$ca28e11_1_16;
	label$ca28e11_1_34:
	if( r4 ) goto label$ca28e11_1_42;
	r11 = (sys__thread___Thread__HaxeThread)hl_alloc_obj(&t$sys_thread__Thread_HaxeThread);
	sys_thread__Thread_HaxeThread_new(r11,r0);
	r4 = r11;
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r9 = r5->threads;
	if( r9 == NULL ) hl_null_access();
	r8 = hl_types_ArrayObj_push(r9,((vdynamic*)r11));
	label$ca28e11_1_42:
	r5 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r7 = r5->threadsMutex;
	hl_mutex_release(r7);
	return r4;
}

void sys_thread__Thread_HaxeThread_create__$2(vdynamic* r0) {
	return;
}

void sys_thread__Thread_HaxeThread_create__$1(venum* r0) {
	sys__thread___Thread__HaxeThread r3;
	hl_thread *r2;
	bool r7;
	sys__thread__EventLoop r8;
	vclosure *r5, *r6;
	haxe__Exception r9;
	vdynamic *r4;
	static vclosure cl$0 = { &t$fun_0ecc9bc, sys_thread__Thread_HaxeThread_create__$2, 0 };
	hl_trap_ctx trap$0;
	r3 = ((Enumt$ctx_2c507b6*)r0)->p2;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->handle;
	if( r2 ) goto label$ca28e11_3_8;
	r3 = ((Enumt$ctx_2c507b6*)r0)->p2;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_thread_current();
	r3->handle = r2;
	label$ca28e11_3_8:
	hl_trap(trap$0,r4,label$ca28e11_3_23);
	r5 = &cl$0;
	hl_set_error_handler(r5);
	r6 = ((Enumt$ctx_2c507b6*)r0)->p0;
	if( r6 == NULL ) hl_null_access();
	r6->hasValue ? ((void (*)(vdynamic*))r6->fun)((vdynamic*)r6->value) : ((void (*)(void))r6->fun)();
	r7 = ((Enumt$ctx_2c507b6*)r0)->p1;
	if( !r7 ) goto label$ca28e11_3_21;
	r3 = ((Enumt$ctx_2c507b6*)r0)->p2;
	if( r3 == NULL ) hl_null_access();
	r8 = r3->events;
	if( r8 == NULL ) hl_null_access();
	sys_thread_EventLoop_loop(r8);
	label$ca28e11_3_21:
	hl_endtrap(trap$0);
	goto label$ca28e11_3_29;
	label$ca28e11_3_23:
	r9 = haxe_Exception_caught(r4);
	r5 = NULL;
	hl_set_error_handler(r5);
	r3 = ((Enumt$ctx_2c507b6*)r0)->p2;
	sys_thread__Thread_HaxeThread_dropThread(r3);
	hl_rethrow((vdynamic*)r9);
	label$ca28e11_3_29:
	r3 = ((Enumt$ctx_2c507b6*)r0)->p2;
	sys_thread__Thread_HaxeThread_dropThread(r3);
	return;
}

sys__thread___Thread__HaxeThread sys_thread__Thread_HaxeThread_create(vclosure* r0,bool r1) {
	sys__thread___Thread__HaxeThread r2;
	hl__types__ArrayObj r8;
	hl_thread *r3;
	venum *r11;
	sys__thread__EventLoop r9;
	sys__thread___Thread__$HaxeThread r6;
	hl_mutex *r5;
	vclosure *r10;
	int r7;
	r2 = (sys__thread___Thread__HaxeThread)hl_alloc_obj(&t$sys_thread__Thread_HaxeThread);
	r3 = NULL;
	sys_thread__Thread_HaxeThread_new(r2,r3);
	r6 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r5 = r6->threadsMutex;
	hl_mutex_acquire(r5);
	r6 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r8 = r6->threads;
	if( r8 == NULL ) hl_null_access();
	r7 = hl_types_ArrayObj_push(r8,((vdynamic*)r2));
	r6 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r5 = r6->threadsMutex;
	hl_mutex_release(r5);
	if( !r1 ) goto label$ca28e11_4_17;
	r9 = (sys__thread__EventLoop)hl_alloc_obj(&t$sys_thread_EventLoop);
	sys_thread_EventLoop_new(r9);
	r2->events = r9;
	label$ca28e11_4_17:
	r11 = hl_alloc_enum(&t$ctx_2c507b6,0);
	((Enumt$ctx_2c507b6*)r11)->p0 = (vclosure*)r0;
	((Enumt$ctx_2c507b6*)r11)->p1 = (bool)r1;
	((Enumt$ctx_2c507b6*)r11)->p2 = (sys__thread___Thread__HaxeThread)r2;
	r10 = hl_alloc_closure_ptr(&t$fun_0d44617,sys_thread__Thread_HaxeThread_create__$1,r11);
	r3 = hl_thread_create(r10);
	r2->handle = r3;
	return r2;
}

void sys_thread__Thread_HaxeThread_dropThread(sys__thread___Thread__HaxeThread r0) {
	sys__thread___Thread__HaxeThread r9;
	hl__types__ArrayObj r5, r8;
	hl__types__ArrayBase r12;
	sys__thread___Thread__$HaxeThread r3;
	hl_mutex *r2;
	vdynamic *r10;
	varray *r11;
	int r4, r6, r7, r13;
	r3 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r2 = r3->threadsMutex;
	hl_mutex_acquire(r2);
	r4 = 0;
	r3 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r5 = r3->threads;
	label$ca28e11_5_6:
	if( r5 == NULL ) hl_null_access();
	r7 = r5->length;
	if( r4 >= r7 ) goto label$ca28e11_5_28;
	r7 = r5->length;
	if( ((unsigned)r4) < ((unsigned)r7) ) goto label$ca28e11_5_14;
	r9 = NULL;
	goto label$ca28e11_5_17;
	label$ca28e11_5_14:
	r11 = r5->array;
	r10 = ((vdynamic**)(r11 + 1))[r4];
	r9 = (sys__thread___Thread__HaxeThread)r10;
	label$ca28e11_5_17:
	r6 = r4;
	++r4;
	if( r9 != r0 ) goto label$ca28e11_5_27;
	r3 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r8 = r3->threads;
	if( r8 == NULL ) hl_null_access();
	r13 = 1;
	r12 = hl_types_ArrayObj_splice(r8,r6,r13);
	r8 = (hl__types__ArrayObj)hl_dyn_castp(&r12,&t$hl_types_ArrayBase,&t$hl_types_ArrayObj);
	goto label$ca28e11_5_28;
	label$ca28e11_5_27:
	goto label$ca28e11_5_6;
	label$ca28e11_5_28:
	r3 = (sys__thread___Thread__$HaxeThread)g$_sys_thread__Thread_HaxeThread;
	r2 = r3->threadsMutex;
	hl_mutex_release(r2);
	return;
}

void sys_thread__Thread_HaxeThread_new(sys__thread___Thread__HaxeThread r0,hl_thread* r1) {
	r0->handle = r1;
	return;
}

