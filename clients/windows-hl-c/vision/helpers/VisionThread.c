// Generated by HLC 4.3.4 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <vision/helpers/VisionThread.h>
#include <vision/exceptions/MultithreadFailure.h>
extern hl_type t$vision_exceptions_MultithreadFailure;
void vision_exceptions_MultithreadFailure_new(vision__exceptions__MultithreadFailure,int,vdynamic*);
haxe__Exception haxe_Exception_caught(vdynamic*);
void vision_helpers_VisionThread_onFailedWrapper(vision__helpers__VisionThread,haxe__Exception);
extern hl_type t$fun_a31ed1a;
sys__thread___Thread__HaxeThread sys_thread__Thread_HaxeThread_create(vclosure*,bool);
extern hl_type t$vision_helpers_VisionThread;
void vision_helpers_VisionThread_new(vision__helpers__VisionThread,vclosure*);
extern hl_type t$fun_7b48b4f;
extern vision__helpers__$VisionThread g$_vision_helpers_VisionThread;
extern hl_type t$fun_96b4604;

void vision_helpers_VisionThread_new__$1(vision__helpers__VisionThread r0,haxe__Exception r1) {
	vision__exceptions__MultithreadFailure r2;
	int r3;
	r2 = (vision__exceptions__MultithreadFailure)hl_alloc_obj(&t$vision_exceptions_MultithreadFailure);
	if( r0 == NULL ) hl_null_access();
	r3 = r0->count;
	vision_exceptions_MultithreadFailure_new(r2,r3,((vdynamic*)r1));
	hl_throw((vdynamic*)r2);
}

void vision_helpers_VisionThread_new__$2() {
	return;
}

void vision_helpers_VisionThread_start__$1(vision__helpers__VisionThread r0) {
	bool r4;
	vclosure *r3;
	haxe__Exception r6;
	vdynamic *r1, *r5;
	hl_trap_ctx trap$0;
	hl_trap(trap$0,r1,label$73c3a34_3_13);
	if( r0 == NULL ) hl_null_access();
	r3 = r0->job;
	if( r3 == NULL ) hl_null_access();
	r3->hasValue ? ((void (*)(vdynamic*))r3->fun)((vdynamic*)r3->value) : ((void (*)(void))r3->fun)();
	r4 = true;
	r5 = hl_alloc_dynbool(r4);
	r0->jobDone = r5;
	r3 = r0->onDone;
	if( r3 == NULL ) hl_null_access();
	r3->hasValue ? ((void (*)(vdynamic*))r3->fun)((vdynamic*)r3->value) : ((void (*)(void))r3->fun)();
	hl_endtrap(trap$0);
	goto label$73c3a34_3_16;
	label$73c3a34_3_13:
	r6 = haxe_Exception_caught(r1);
	if( r0 == NULL ) hl_null_access();
	vision_helpers_VisionThread_onFailedWrapper(r0,r6);
	label$73c3a34_3_16:
	return;
}

void vision_helpers_VisionThread_start(vision__helpers__VisionThread r0) {
	sys__thread___Thread__HaxeThread r2;
	bool r4;
	vclosure *r3;
	r3 = hl_alloc_closure_ptr(&t$fun_a31ed1a,vision_helpers_VisionThread_start__$1,r0);
	r4 = false;
	r2 = sys_thread__Thread_HaxeThread_create(r3,r4);
	r0->underlying = r2;
	return;
}

void vision_helpers_VisionThread_onFailedWrapper(vision__helpers__VisionThread r0,haxe__Exception r1) {
	bool r2;
	vclosure *r5;
	vdynamic *r3;
	r2 = false;
	r3 = hl_alloc_dynbool(r2);
	r0->jobDone = r3;
	r5 = r0->onFailed;
	if( r5 == NULL ) hl_null_access();
	r5->hasValue ? ((void (*)(vdynamic*,haxe__Exception))r5->fun)((vdynamic*)r5->value,r1) : ((void (*)(haxe__Exception))r5->fun)(r1);
	return;
}

vision__helpers__VisionThread vision_helpers_VisionThread_create(vclosure* r0) {
	vision__helpers__VisionThread r1;
	r1 = (vision__helpers__VisionThread)hl_alloc_obj(&t$vision_helpers_VisionThread);
	vision_helpers_VisionThread_new(r1,r0);
	vision_helpers_VisionThread_start(r1);
	return r1;
}

vclosure* vision_helpers_VisionThread_set_onFailed(vision__helpers__VisionThread r0,vclosure* r1) {
	bool r3;
	haxe__Exception r5;
	vdynamic *r4;
	r3 = r0->relaunchEvents;
	if( !r3 ) goto label$73c3a34_7_7;
	r4 = r0->jobDone;
	if( !r4 ) goto label$73c3a34_7_7;
	if( r1 == NULL ) hl_null_access();
	r5 = NULL;
	r1->hasValue ? ((void (*)(vdynamic*,haxe__Exception))r1->fun)((vdynamic*)r1->value,r5) : ((void (*)(haxe__Exception))r1->fun)(r5);
	label$73c3a34_7_7:
	r0->onFailed = r1;
	return r1;
}

vclosure* vision_helpers_VisionThread_set_onDone(vision__helpers__VisionThread r0,vclosure* r1) {
	bool r3;
	vdynamic *r4;
	r3 = r0->relaunchEvents;
	if( !r3 ) goto label$73c3a34_8_6;
	r4 = r0->jobDone;
	if( !r4 ) goto label$73c3a34_8_6;
	if( r1 == NULL ) hl_null_access();
	r1->hasValue ? ((void (*)(vdynamic*))r1->fun)((vdynamic*)r1->value) : ((void (*)(void))r1->fun)();
	label$73c3a34_8_6:
	r0->onDone = r1;
	return r1;
}

void vision_helpers_VisionThread_new(vision__helpers__VisionThread r0,vclosure* r1) {
	bool r2;
	vision__helpers__$VisionThread r5;
	vclosure *r4, *r8;
	int r6, r7;
	static vclosure cl$0 = { &t$fun_7b48b4f, vision_helpers_VisionThread_new__$2, 0 };
	r2 = false;
	r0->relaunchEvents = r2;
	r0->job = r1;
	r5 = (vision__helpers__$VisionThread)g$_vision_helpers_VisionThread;
	r6 = r5->COUNT;
	r7 = r6;
	++r6;
	r5->COUNT = r6;
	r0->count = r7;
	r8 = hl_alloc_closure_ptr(&t$fun_96b4604,vision_helpers_VisionThread_new__$1,r0);
	r8 = vision_helpers_VisionThread_set_onFailed(r0,r8);
	r4 = &cl$0;
	r4 = vision_helpers_VisionThread_set_onDone(r0,r4);
	return;
}

