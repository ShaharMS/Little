// Generated by HLC 4.3.4 (HL v5)
#define HLC_BOOT
#include <hlc.h>
#include <vision/algorithms/GaussJordan.h>
#include <hl/types/ArrayDyn.h>
#include <hl/types/ArrayBytes_Float.h>
vision__ds__Array2D vision_algorithms_GaussJordan_createIdentityMatrix(int);
hl__types__ArrayObj vision_ds__Matrix2D_Matrix2D_Impl__to_array_array_float(vision__ds__Array2D);
vision__ds__Array2D vision_algorithms_GaussJordan_augmentMatrix(hl__types__ArrayObj,hl__types__ArrayObj);
extern hl_type t$hl_types_ArrayBytes_Float;
extern hl_type t$hl_types_ArrayDyn;
#include <hl/natives.h>
extern String s$Matrix_is_not_invertible;
void vision_algorithms_GaussJordan_swapRows(hl__types__ArrayObj,int,int);
void hl_types_ArrayBytes_Float___expand(hl__types__ArrayBytes_Float,int);
hl__types__ArrayBytes_Int hl_types_ArrayBase_allocI32(vbyte*,int);
int hl_types_ArrayBytes_Int_push(hl__types__ArrayBytes_Int,int);
vision__ds__Array2D vision_algorithms_GaussJordan_extractMatrix(vision__ds__Array2D,int,hl__types__ArrayBytes_Int);
hl__types__ArrayObj hl_types_ArrayObj_alloc(varray*);
void hl_types_ArrayBytes_Float_new(hl__types__ArrayBytes_Float);
int hl_types_ArrayObj_push(hl__types__ArrayObj,vdynamic*);
extern hl_type t$_dyn;
int hl_types_ArrayBytes_Float_push(hl__types__ArrayBytes_Float,double);
vision__ds__Array2D vision_ds__Matrix2D_Matrix2D_Impl__from_array_array_float(hl__types__ArrayObj);
hl__types__ArrayBytes_Float hl_types_ArrayBytes_Float_concat(hl__types__ArrayBytes_Float,hl__types__ArrayBytes_Float);
void hl_types_ArrayObj___expand(hl__types__ArrayObj,int);

vision__ds__Array2D vision_algorithms_GaussJordan_invert(vision__ds__Array2D r0) {
	String r22;
	hl__types__ArrayObj r6, r7;
	vision__ds__Array2D r2, r5, r15;
	hl__types__ArrayBytes_Int r30;
	hl__types__ArrayBytes_Float r18, r28;
	hl__types__ArrayDyn r17;
	double r16, r21, r27, r29;
	vbyte *r20;
	int r1, r4, r8, r9, r10, r11, r12, r13, r14, r19, r23, r24, r25, r26;
	if( r0 == NULL ) hl_null_access();
	r1 = r0->height;
	r2 = vision_algorithms_GaussJordan_createIdentityMatrix(r1);
	r6 = vision_ds__Matrix2D_Matrix2D_Impl__to_array_array_float(r0);
	r7 = vision_ds__Matrix2D_Matrix2D_Impl__to_array_array_float(r2);
	r5 = vision_algorithms_GaussJordan_augmentMatrix(r6,r7);
	r4 = 0;
	r8 = r1;
	label$57a5e0f_1_8:
	if( r4 >= r8 ) goto label$57a5e0f_1_174;
	r9 = r4;
	++r4;
	r10 = r9;
	r12 = 1;
	r11 = r9 + r12;
	r12 = r1;
	label$57a5e0f_1_16:
	if( r11 >= r12 ) goto label$57a5e0f_1_54;
	r13 = r11;
	++r11;
	if( r5 == NULL ) hl_null_access();
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r19 = r5->width;
	r14 = r9 * r19;
	r14 = r14 + r13;
	r19 = r18->length;
	if( ((unsigned)r14) < ((unsigned)r19) ) goto label$57a5e0f_1_31;
	r16 = 0.;
	goto label$57a5e0f_1_35;
	label$57a5e0f_1_31:
	r20 = r18->bytes;
	r19 = 3;
	r19 = r14 << r19;
	r16 = *(double*)(r20 + r19);
	label$57a5e0f_1_35:
	r16 = hl_math_abs(r16);
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r19 = r5->width;
	r14 = r9 * r19;
	r14 = r14 + r10;
	r19 = r18->length;
	if( ((unsigned)r14) < ((unsigned)r19) ) goto label$57a5e0f_1_46;
	r21 = 0.;
	goto label$57a5e0f_1_50;
	label$57a5e0f_1_46:
	r20 = r18->bytes;
	r19 = 3;
	r19 = r14 << r19;
	r21 = *(double*)(r20 + r19);
	label$57a5e0f_1_50:
	r21 = hl_math_abs(r21);
	if( !(r21 < r16) ) goto label$57a5e0f_1_53;
	r10 = r13;
	label$57a5e0f_1_53:
	goto label$57a5e0f_1_16;
	label$57a5e0f_1_54:
	if( r5 == NULL ) hl_null_access();
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r12 = r5->width;
	r11 = r9 * r12;
	r11 = r11 + r10;
	r12 = r18->length;
	if( ((unsigned)r11) < ((unsigned)r12) ) goto label$57a5e0f_1_65;
	r16 = 0.;
	goto label$57a5e0f_1_69;
	label$57a5e0f_1_65:
	r20 = r18->bytes;
	r12 = 3;
	r12 = r11 << r12;
	r16 = *(double*)(r20 + r12);
	label$57a5e0f_1_69:
	r16 = hl_math_abs(r16);
	r21 = 9.9999999999999998e-013;
	if( !(r16 < r21) ) goto label$57a5e0f_1_74;
	r22 = (String)s$Matrix_is_not_invertible;
	hl_throw((vdynamic*)r22);
	label$57a5e0f_1_74:
	if( r10 == r9 ) goto label$57a5e0f_1_77;
	r6 = vision_ds__Matrix2D_Matrix2D_Impl__to_array_array_float(r5);
	vision_algorithms_GaussJordan_swapRows(r6,r9,r10);
	label$57a5e0f_1_77:
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r12 = r5->width;
	r11 = r9 * r12;
	r11 = r11 + r9;
	r12 = r18->length;
	if( ((unsigned)r11) < ((unsigned)r12) ) goto label$57a5e0f_1_87;
	r16 = 0.;
	goto label$57a5e0f_1_91;
	label$57a5e0f_1_87:
	r20 = r18->bytes;
	r12 = 3;
	r12 = r11 << r12;
	r16 = *(double*)(r20 + r12);
	label$57a5e0f_1_91:
	r11 = 0;
	r12 = 2;
	r12 = r12 * r1;
	label$57a5e0f_1_94:
	if( r11 >= r12 ) goto label$57a5e0f_1_113;
	r13 = r11;
	++r11;
	if( r5 == NULL ) hl_null_access();
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r23 = r5->width;
	r19 = r13 * r23;
	r14 = r9 + r19;
	r19 = r18->length;
	if( ((unsigned)r14) < ((unsigned)r19) ) goto label$57a5e0f_1_108;
	hl_types_ArrayBytes_Float___expand(r18,r14);
	label$57a5e0f_1_108:
	r20 = r18->bytes;
	r19 = 3;
	r19 = r14 << r19;
	*(double*)(r20 + r19) = r16;
	goto label$57a5e0f_1_94;
	label$57a5e0f_1_113:
	r11 = 0;
	r12 = r1;
	label$57a5e0f_1_115:
	if( r11 >= r12 ) goto label$57a5e0f_1_173;
	r13 = r11;
	++r11;
	if( r13 == r9 ) goto label$57a5e0f_1_172;
	if( r5 == NULL ) hl_null_access();
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r19 = r5->width;
	r14 = r9 * r19;
	r14 = r14 + r13;
	r19 = r18->length;
	if( ((unsigned)r14) < ((unsigned)r19) ) goto label$57a5e0f_1_131;
	r21 = 0.;
	goto label$57a5e0f_1_135;
	label$57a5e0f_1_131:
	r20 = r18->bytes;
	r19 = 3;
	r19 = r14 << r19;
	r21 = *(double*)(r20 + r19);
	label$57a5e0f_1_135:
	r14 = 0;
	r19 = 2;
	r19 = r19 * r1;
	label$57a5e0f_1_138:
	if( r14 >= r19 ) goto label$57a5e0f_1_172;
	r23 = r14;
	++r14;
	if( r5 == NULL ) hl_null_access();
	r17 = r5->inner;
	r18 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r18 == NULL ) hl_null_access();
	r26 = r5->width;
	r25 = r23 * r26;
	r24 = r13 + r25;
	r17 = r5->inner;
	r28 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r28 == NULL ) hl_null_access();
	r26 = r5->width;
	r25 = r23 * r26;
	r25 = r25 + r9;
	r26 = r28->length;
	if( ((unsigned)r25) < ((unsigned)r26) ) goto label$57a5e0f_1_159;
	r29 = 0.;
	goto label$57a5e0f_1_163;
	label$57a5e0f_1_159:
	r20 = r28->bytes;
	r26 = 3;
	r26 = r25 << r26;
	r29 = *(double*)(r20 + r26);
	label$57a5e0f_1_163:
	r27 = r21 * r29;
	r25 = r18->length;
	if( ((unsigned)r24) < ((unsigned)r25) ) goto label$57a5e0f_1_167;
	hl_types_ArrayBytes_Float___expand(r18,r24);
	label$57a5e0f_1_167:
	r20 = r18->bytes;
	r25 = 3;
	r25 = r24 << r25;
	*(double*)(r20 + r25) = r27;
	goto label$57a5e0f_1_138;
	label$57a5e0f_1_172:
	goto label$57a5e0f_1_115;
	label$57a5e0f_1_173:
	goto label$57a5e0f_1_8;
	label$57a5e0f_1_174:
	r4 = 0;
	r20 = hl_alloc_bytes(r4);
	r4 = 0;
	r4 = 0;
	r30 = hl_types_ArrayBase_allocI32(r20,r4);
	r8 = 1;
	r4 = r1 + r8;
	r8 = 2;
	r8 = r8 * r1;
	label$57a5e0f_1_183:
	if( r4 >= r8 ) goto label$57a5e0f_1_190;
	r9 = r4;
	++r4;
	if( r30 == NULL ) hl_null_access();
	r10 = hl_types_ArrayBytes_Int_push(r30,r9);
	goto label$57a5e0f_1_183;
	label$57a5e0f_1_190:
	r15 = vision_algorithms_GaussJordan_extractMatrix(r5,r1,r30);
	return r15;
}

vision__ds__Array2D vision_algorithms_GaussJordan_createIdentityMatrix(int r0) {
	vision__ds__Array2D r16;
	hl__types__ArrayObj r1;
	hl_type *r3;
	hl__types__ArrayBytes_Float r9;
	double r15;
	vdynamic *r14;
	int r4, r6, r7, r8, r10, r11, r12, r13;
	varray *r2;
	r3 = &t$hl_types_ArrayBytes_Float;
	r4 = 0;
	r2 = hl_alloc_array(r3,r4);
	r1 = hl_types_ArrayObj_alloc(r2);
	r4 = 0;
	r6 = r0;
	label$57a5e0f_2_6:
	if( r4 >= r6 ) goto label$57a5e0f_2_46;
	r7 = r4;
	++r4;
	if( r1 == NULL ) hl_null_access();
	r9 = (hl__types__ArrayBytes_Float)hl_alloc_obj(&t$hl_types_ArrayBytes_Float);
	hl_types_ArrayBytes_Float_new(r9);
	r8 = hl_types_ArrayObj_push(r1,((vdynamic*)r9));
	r8 = 0;
	r10 = r0;
	label$57a5e0f_2_16:
	if( r8 >= r10 ) goto label$57a5e0f_2_45;
	r11 = r8;
	++r8;
	if( r7 != r11 ) goto label$57a5e0f_2_33;
	if( r1 == NULL ) hl_null_access();
	r13 = r1->length;
	if( ((unsigned)r7) < ((unsigned)r13) ) goto label$57a5e0f_2_26;
	r9 = NULL;
	goto label$57a5e0f_2_29;
	label$57a5e0f_2_26:
	r2 = r1->array;
	r14 = ((vdynamic**)(r2 + 1))[r7];
	r9 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r14,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_2_29:
	if( r9 == NULL ) hl_null_access();
	r15 = 1.;
	r12 = hl_types_ArrayBytes_Float_push(r9,r15);
	goto label$57a5e0f_2_44;
	label$57a5e0f_2_33:
	if( r1 == NULL ) hl_null_access();
	r13 = r1->length;
	if( ((unsigned)r7) < ((unsigned)r13) ) goto label$57a5e0f_2_38;
	r9 = NULL;
	goto label$57a5e0f_2_41;
	label$57a5e0f_2_38:
	r2 = r1->array;
	r14 = ((vdynamic**)(r2 + 1))[r7];
	r9 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r14,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_2_41:
	if( r9 == NULL ) hl_null_access();
	r15 = 0.;
	r12 = hl_types_ArrayBytes_Float_push(r9,r15);
	label$57a5e0f_2_44:
	goto label$57a5e0f_2_16;
	label$57a5e0f_2_45:
	goto label$57a5e0f_2_6;
	label$57a5e0f_2_46:
	r16 = vision_ds__Matrix2D_Matrix2D_Impl__from_array_array_float(r1);
	return r16;
}

vision__ds__Array2D vision_algorithms_GaussJordan_augmentMatrix(hl__types__ArrayObj r0,hl__types__ArrayObj r1) {
	vision__ds__Array2D r13;
	hl__types__ArrayObj r2;
	hl_type *r4;
	hl__types__ArrayBytes_Float r9, r12;
	vdynamic *r11;
	int r5, r6, r7, r8, r10;
	varray *r3;
	r4 = &t$hl_types_ArrayBytes_Float;
	r5 = 0;
	r3 = hl_alloc_array(r4,r5);
	r2 = hl_types_ArrayObj_alloc(r3);
	r5 = 0;
	if( r0 == NULL ) hl_null_access();
	r6 = r0->length;
	label$57a5e0f_3_7:
	if( r5 >= r6 ) goto label$57a5e0f_3_32;
	r7 = r5;
	++r5;
	if( r2 == NULL ) hl_null_access();
	if( r0 == NULL ) hl_null_access();
	r10 = r0->length;
	if( ((unsigned)r7) < ((unsigned)r10) ) goto label$57a5e0f_3_17;
	r9 = NULL;
	goto label$57a5e0f_3_20;
	label$57a5e0f_3_17:
	r3 = r0->array;
	r11 = ((vdynamic**)(r3 + 1))[r7];
	r9 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r11,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_3_20:
	if( r9 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r10 = r1->length;
	if( ((unsigned)r7) < ((unsigned)r10) ) goto label$57a5e0f_3_26;
	r12 = NULL;
	goto label$57a5e0f_3_29;
	label$57a5e0f_3_26:
	r3 = r1->array;
	r11 = ((vdynamic**)(r3 + 1))[r7];
	r12 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r11,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_3_29:
	r9 = hl_types_ArrayBytes_Float_concat(r9,r12);
	r8 = hl_types_ArrayObj_push(r2,((vdynamic*)r9));
	goto label$57a5e0f_3_7;
	label$57a5e0f_3_32:
	r13 = vision_ds__Matrix2D_Matrix2D_Impl__from_array_array_float(r2);
	return r13;
}

void vision_algorithms_GaussJordan_swapRows(hl__types__ArrayObj r0,int r1,int r2) {
	hl__types__ArrayBytes_Float r4, r9;
	vdynamic *r5;
	varray *r6;
	int r3, r8;
	if( r0 == NULL ) hl_null_access();
	r3 = r0->length;
	if( ((unsigned)r1) < ((unsigned)r3) ) goto label$57a5e0f_4_5;
	r4 = NULL;
	goto label$57a5e0f_4_8;
	label$57a5e0f_4_5:
	r6 = r0->array;
	r5 = ((vdynamic**)(r6 + 1))[r1];
	r4 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r5,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_4_8:
	r8 = r0->length;
	if( ((unsigned)r2) < ((unsigned)r8) ) goto label$57a5e0f_4_12;
	r9 = NULL;
	goto label$57a5e0f_4_15;
	label$57a5e0f_4_12:
	r6 = r0->array;
	r5 = ((vdynamic**)(r6 + 1))[r2];
	r9 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r5,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_4_15:
	r3 = r0->length;
	if( ((unsigned)r1) < ((unsigned)r3) ) goto label$57a5e0f_4_18;
	hl_types_ArrayObj___expand(r0,r1);
	label$57a5e0f_4_18:
	r6 = r0->array;
	((hl__types__ArrayBytes_Float*)(r6 + 1))[r1] = r9;
	r3 = r0->length;
	if( ((unsigned)r2) < ((unsigned)r3) ) goto label$57a5e0f_4_23;
	hl_types_ArrayObj___expand(r0,r2);
	label$57a5e0f_4_23:
	r6 = r0->array;
	((hl__types__ArrayBytes_Float*)(r6 + 1))[r2] = r4;
	return;
}

vision__ds__Array2D vision_algorithms_GaussJordan_extractMatrix(vision__ds__Array2D r0,int r1,hl__types__ArrayBytes_Int r2) {
	vision__ds__Array2D r15;
	hl__types__ArrayObj r3;
	hl_type *r5;
	hl__types__ArrayBytes_Float r11, r19;
	double r20;
	hl__types__ArrayDyn r18;
	vdynamic *r17;
	vbyte *r14;
	int r6, r8, r9, r10, r12, r13, r16;
	varray *r4;
	r5 = &t$hl_types_ArrayBytes_Float;
	r6 = 0;
	r4 = hl_alloc_array(r5,r6);
	r3 = hl_types_ArrayObj_alloc(r4);
	r6 = 0;
	r8 = r1;
	label$57a5e0f_5_6:
	if( r6 >= r8 ) goto label$57a5e0f_5_55;
	r9 = r6;
	++r6;
	if( r3 == NULL ) hl_null_access();
	r11 = (hl__types__ArrayBytes_Float)hl_alloc_obj(&t$hl_types_ArrayBytes_Float);
	hl_types_ArrayBytes_Float_new(r11);
	r10 = hl_types_ArrayObj_push(r3,((vdynamic*)r11));
	r10 = 0;
	label$57a5e0f_5_15:
	if( r2 == NULL ) hl_null_access();
	r13 = r2->length;
	if( r10 >= r13 ) goto label$57a5e0f_5_54;
	r13 = r2->length;
	if( ((unsigned)r10) < ((unsigned)r13) ) goto label$57a5e0f_5_23;
	r12 = 0;
	goto label$57a5e0f_5_27;
	label$57a5e0f_5_23:
	r14 = r2->bytes;
	r13 = 2;
	r13 = r10 << r13;
	r12 = *(int*)(r14 + r13);
	label$57a5e0f_5_27:
	++r10;
	if( r3 == NULL ) hl_null_access();
	r16 = r3->length;
	if( ((unsigned)r9) < ((unsigned)r16) ) goto label$57a5e0f_5_33;
	r11 = NULL;
	goto label$57a5e0f_5_36;
	label$57a5e0f_5_33:
	r4 = r3->array;
	r17 = ((vdynamic**)(r4 + 1))[r9];
	r11 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r17,&t$_dyn,&t$hl_types_ArrayBytes_Float);
	label$57a5e0f_5_36:
	if( r11 == NULL ) hl_null_access();
	if( r0 == NULL ) hl_null_access();
	r18 = r0->inner;
	r19 = (hl__types__ArrayBytes_Float)hl_dyn_castp(&r18,&t$hl_types_ArrayDyn,&t$hl_types_ArrayBytes_Float);
	if( r19 == NULL ) hl_null_access();
	r16 = r0->width;
	r13 = r12 * r16;
	r13 = r13 + r9;
	r16 = r19->length;
	if( ((unsigned)r13) < ((unsigned)r16) ) goto label$57a5e0f_5_48;
	r20 = 0.;
	goto label$57a5e0f_5_52;
	label$57a5e0f_5_48:
	r14 = r19->bytes;
	r16 = 3;
	r16 = r13 << r16;
	r20 = *(double*)(r14 + r16);
	label$57a5e0f_5_52:
	r13 = hl_types_ArrayBytes_Float_push(r11,r20);
	goto label$57a5e0f_5_15;
	label$57a5e0f_5_54:
	goto label$57a5e0f_5_6;
	label$57a5e0f_5_55:
	r15 = vision_ds__Matrix2D_Matrix2D_Impl__from_array_array_float(r3);
	return r15;
}

